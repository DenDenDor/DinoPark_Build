<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Ваша Игра</title>
    <script src="%UNITY_WEBGL_LOADER_URL%"></script>
    <style>
        body { margin: 0; padding: 0; overflow: hidden }
        #unity-container { position: absolute; width: 100%; height: 100% }
    </style>
</head>
<body>
    <div id="unity-container"></div>
    <script>
    // ===== ОСНОВНАЯ ЧАСТЬ ДЛЯ UNITY =====
    var buildUrl = "Build";
    var config = {
        dataUrl: buildUrl + "/%UNITY_DATA_FILENAME%",
        frameworkUrl: buildUrl + "/%UNITY_FRAMEWORK_FILENAME%",
        codeUrl: buildUrl + "/%UNITY_CODE_FILENAME%",
        streamingAssetsUrl: "StreamingAssets",
        companyName: "%UNITY_COMPANY_NAME%",
        productName: "%UNITY_PRODUCT_NAME%",
        productVersion: "%UNITY_PRODUCT_VERSION%",
    };

    var container = document.querySelector("#unity-container");
    var canvas = document.createElement("canvas");
    container.appendChild(canvas);
    
    // ===== ТЕЛЕГРАМ ИНТЕГРАЦИЯ =====
    function GetTelegramAuth() {
        if (window.Telegram && window.Telegram.WebApp) {
            const user = Telegram.WebApp.initDataUnsafe.user || {};
            return JSON.stringify({
                id: user.id || '0',
                first_name: user.first_name || '',
                last_name: user.last_name || '',
                username: user.username || '',
                language_code: user.language_code || 'en',
                allows_write_to_pm: user.allows_write_to_pm || false,
                photo_url: user.photo_url || '',
                auth_date: Telegram.WebApp.initDataUnsafe.auth_date || '',
                hash: Telegram.WebApp.initDataUnsafe.hash || '',
                query_id: Telegram.WebApp.initDataUnsafe.query_id || ''
            });
        }
        return JSON.stringify({ error: "Not in Telegram" });
    }

    // Экспорт функций в Unity
    mergeInto(LibraryManager.library, {
        GetTelegramAuth: function() {
            const json = GetTelegramAuth();
            const buffer = _malloc(json.length + 1);
            stringToUTF8(json, buffer, buffer.length);
            return buffer;
        },
        _free: function(ptr) { _free(ptr); }
    });

    // Запуск Unity
    var gameInstance = UnityLoader.instantiate("unity-container", config);
    </script>
</body>
</html>
